services:
  # Backend API Service
  - type: web
    name: ai-browser-security-backend
    runtime: node
    rootDir: AWI/backend
    buildCommand: npm install
    startCommand: npm start
    healthCheckPath: /api/health
    envVars:
      # MongoDB Configuration (use MongoDB Atlas)
      - key: MONGODB_URI
        sync: false # Set this in Render dashboard with your MongoDB Atlas connection string

      # Server Configuration
      - key: PORT
        value: 5000
      - key: NODE_ENV
        value: production

      # Session Configuration
      - key: SESSION_TTL_MINUTES
        value: 30
      - key: LIST_CACHE_TTL_MINUTES
        value: 5
      - key: MEDIA_CACHE_TTL_MINUTES
        value: 60

      # Security Configuration
      - key: JWT_SECRET
        generateValue: true # Render will generate a random secret
      - key: BCRYPT_ROUNDS
        value: 10

      # AWI Configuration
      - key: AWI_MODE_ENABLED
        value: true
      - key: AWI_USE_REDIS
        value: false
      - key: AWI_MAX_ACTIONS_PER_SESSION
        value: 1000
      - key: AWI_CLEANUP_INTERVAL_MINUTES
        value: 60

      # CORS Configuration (set manually after frontend deployment)
      # Format: https://your-frontend-name.onrender.com
      - key: CORS_ORIGIN
        sync: false

      # Admin Dashboard
      - key: ADMIN_DASHBOARD_ENABLED
        value: true

  # Frontend Static Site
  - type: web
    name: ai-browser-security-frontend
    runtime: static
    rootDir: AWI/frontend
    buildCommand: npm install && npm run build
    staticPublishPath: dist
    routes:
      - type: rewrite
        source: /*
        destination: /index.html
    envVars:
      # Set this to your backend URL after deployment
      # Format: https://your-backend-name.onrender.com
      - key: VITE_API_URL
        sync: false

# Database Note:
# MongoDB is not available as a native Render service.
# Use MongoDB Atlas (free tier available): https://www.mongodb.com/cloud/atlas
