services:
  # Unified Backend + Frontend Service
  - type: web
    name: ai-browser-security
    runtime: node
    buildCommand: npm run build
    startCommand: npm start
    healthCheckPath: /api/health
    envVars:
      # MongoDB Configuration (use MongoDB Atlas)
      - key: MONGODB_URI
        sync: false  # Set this in Render dashboard with your MongoDB Atlas connection string

      # Server Configuration
      # Note: PORT is automatically provided by Render, don't override it
      - key: NODE_ENV
        value: production

      # Session Configuration
      - key: SESSION_TTL_MINUTES
        value: 30
      - key: LIST_CACHE_TTL_MINUTES
        value: 5
      - key: MEDIA_CACHE_TTL_MINUTES
        value: 60

      # Security Configuration
      - key: JWT_SECRET
        generateValue: true  # Render will generate a random secret
      - key: BCRYPT_ROUNDS
        value: 10

      # AWI Configuration
      - key: AWI_MODE_ENABLED
        value: true
      - key: AWI_USE_REDIS
        value: false
      - key: AWI_MAX_ACTIONS_PER_SESSION
        value: 1000
      - key: AWI_CLEANUP_INTERVAL_MINUTES
        value: 60

      # CORS Configuration (same domain, no CORS needed)
      # But keeping for local development
      - key: CORS_ORIGIN
        value: "*"

      # Admin Dashboard
      - key: ADMIN_DASHBOARD_ENABLED
        value: true

      # Frontend API URL (same domain in production)
      - key: VITE_API_URL
        value: ""  # Empty = same domain

# Database Note:
# MongoDB is not available as a native Render service.
# Use MongoDB Atlas (free tier available): https://www.mongodb.com/cloud/atlas
# After creating your cluster, add the connection string to MONGODB_URI in the Render dashboard.